<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN"
"http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd">

<html xmlns="http://www.w3.org/1999/xhtml">
 <head>
  <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
  <title>Re: Getting project classes from plugin</title>
  <link rel="stylesheet" type="text/css" href="/archives/style.css" />
 </head>

 <body id="archives">
  <h1>maven-users mailing list archives</h1>

  <h5>
<a href="http://mail-archives.apache.org/mod_mbox/" title="Back to the archives depot">Site index</a> &middot; <a href="/mod_mbox/maven-users" title="Back to the list index">List index</a></h5>  <table class="static" id="msgview">
   <thead>
    <tr>
    <th class="title">Message view</th>
    <th class="nav"><a href="/mod_mbox/maven-users/201609.mbox/%3c03f616af-91ee-c4a7-e9f9-dab4a6f1a69d@apache.org%3e" title="Previous by date">&laquo;</a> <a href="/mod_mbox/maven-users/201609.mbox/date" title="View messages sorted by date">Date</a> <a href="/mod_mbox/maven-users/201609.mbox/%3cfc76f023-20ff-6633-e9cc-bbb90995d02b@gmx.de%3e" title="Next by date">&raquo;</a> &middot; <a href="/mod_mbox/maven-users/201609.mbox/%3c03f616af-91ee-c4a7-e9f9-dab4a6f1a69d@apache.org%3e" title="Previous by thread">&laquo;</a> <a href="/mod_mbox/maven-users/201609.mbox/thread" title="View messages sorted by thread">Thread</a> <a href="/mod_mbox/maven-users/201609.mbox/%3cCAL5zq9aVGWJ1AVRaO1F77NaP-mUUSA6vQ2Liwnmpo3P6AFGFhA@mail.gmail.com%3e" title="Next by thread">&raquo;</a></th>
   </tr>
   </thead>

   <tfoot>
    <tr>
    <th class="title"><a href="#archives">Top</a></th>
    <th class="nav"><a href="/mod_mbox/maven-users/201609.mbox/%3c03f616af-91ee-c4a7-e9f9-dab4a6f1a69d@apache.org%3e" title="Previous by date">&laquo;</a> <a href="/mod_mbox/maven-users/201609.mbox/date" title="View messages sorted by date">Date</a> <a href="/mod_mbox/maven-users/201609.mbox/%3cfc76f023-20ff-6633-e9cc-bbb90995d02b@gmx.de%3e" title="Next by date">&raquo;</a> &middot; <a href="/mod_mbox/maven-users/201609.mbox/%3c03f616af-91ee-c4a7-e9f9-dab4a6f1a69d@apache.org%3e" title="Previous by thread">&laquo;</a> <a href="/mod_mbox/maven-users/201609.mbox/thread" title="View messages sorted by thread">Thread</a> <a href="/mod_mbox/maven-users/201609.mbox/%3cCAL5zq9aVGWJ1AVRaO1F77NaP-mUUSA6vQ2Liwnmpo3P6AFGFhA@mail.gmail.com%3e" title="Next by thread">&raquo;</a></th>
   </tr>
   </tfoot>

   <tbody>
   <tr class="from">
    <td class="left">From</td>
    <td class="right">Christopher &lt;ctubb...@apache.org&gt;</td>
   </tr>
   <tr class="subject">
    <td class="left">Subject</td>
    <td class="right">Re: Getting project classes from plugin</td>
   </tr>
   <tr class="date">
    <td class="left">Date</td>
    <td class="right">Mon, 05 Sep 2016 18:04:17 GMT</td>
   </tr>
   <tr class="contents"><td colspan="2"><pre>
Unfortunately, using project.getBuild().getOutputDirectory() doesn't work
either. The classloader I created from that still contains other classes,
like plexus, and jdk classes. Additionally, because it didn't have the
dependencies, some of the annotations I need to process weren't loaded by
the classloader.

At this point, I think what I need to do is manually walk through the
*.class files in project.getBuild().getOutputDirectory() and use what I
find to filter the classes in the classloader from
project.getCompileClasspathElements(). I was hoping Maven provided a
primitive to list these classes, but walking the directory tree should
work. I've just got to be careful about matching the filenames with the
class names in the classloader, especially with respect to anonymous
inner-classes, member classes, static nested classes, and secondary classes
defined in the same .java file.

On Mon, Sep 5, 2016 at 1:40 PM Guillaume Boué &lt;gboue@apache.org&gt; wrote:

&gt; Hi,
&gt;
&gt; You should be able to get only the project compiled classes with
&gt; project.getBuild().getOutputDirectory(). Internally, this is what
&gt; getCompileClasspathElements does. For the test classpath, you have the
&gt; similar project.getBuild().getTestOutputDirectory().
&gt;
&gt; With those two folders, you can create the URLClassLoader that load the
&gt; classes.
&gt;
&gt; Guillaume,
&gt;
&gt;
&gt; Le 05/09/2016 à 06:05, Francois-Xavier Bonnet a écrit :
&gt; &gt; When I wrote builder-maven-plugin &lt;https://javabuild.java.net/&gt; I had
&gt; to do
&gt; &gt; things with some project classes. What I did was scan the source code and
&gt; &gt; then load the corresponding .class for each .java file found. Maybe you
&gt; &gt; could do the same.
&gt; &gt; The code is here:
&gt; &gt;
&gt; https://github.com/javabuild/builder-parent/blob/master/builder-maven-plugin/src/main/java/net/java/javabuild/ExecuteMojo.java
&gt; &gt;
&gt; &gt; On 5 September 2016 at 13:56, Barrie Treloar &lt;baerrach@gmail.com&gt; wrote:
&gt; &gt;
&gt; &gt;&gt; On 5 September 2016 at 12:11, Christopher &lt;ctubbsii@apache.org&gt; wrote:
&gt; &gt;&gt;
&gt; &gt;&gt;&gt; Hi,
&gt; &gt;&gt;&gt;
&gt; &gt;&gt;&gt; I'm trying to write a Maven plugin which gets, and processes, a list of
&gt; &gt;&gt;&gt; classes from the project. I want to be able to get the project classes
&gt; &gt;&gt;&gt; compiled from either src/main/java (compile scope), and src/test/java
&gt; &gt;&gt; (test
&gt; &gt;&gt;&gt; scope, minus compile scope), depending on user configuration.
&gt; &gt;&gt;&gt;
&gt; &gt;&gt;&gt; So far, the closest things I've found to help me are (project is an
&gt; &gt;&gt;&gt; instance of MavenProject):
&gt; &gt;&gt;&gt; project.getCompileClasspathElements()
&gt; &gt;&gt;&gt; and
&gt; &gt;&gt;&gt; project.getTestClasspathElements()
&gt; &gt;&gt;&gt;
&gt; &gt;&gt;&gt; I then use that to build a URLClassLoader, which I then use Guava's
&gt; &gt;&gt;&gt; ClassPath utility to find all the classes.
&gt; &gt;&gt;&gt;
&gt; &gt;&gt;&gt; The problem is, that brings in the whole classpath, and all I want is
&gt; &gt;&gt; just
&gt; &gt;&gt;&gt; the project's own classes, not those from dependencies (including Java
&gt; &gt;&gt;&gt; itself). And, the test classpath elements includes the compile-time
&gt; &gt;&gt; scoped
&gt; &gt;&gt;&gt; items, as well, which I don't necessarily want. I could probably do set
&gt; &gt;&gt;&gt; subtraction to remove the compile-time scope from the test scope, but I
&gt; &gt;&gt;&gt; can't figure out how to get rid of what's being added as dependencies,
&gt; &gt;&gt;&gt; which I don't wish to process. Perhaps I can do set subtraction from
&gt; the
&gt; &gt;&gt;&gt; dependencies? Is there a way to enumerate the classpath of just the
&gt; &gt;&gt;&gt; dependencies?
&gt; &gt;&gt;&gt;
&gt; &gt;&gt;&gt; Has anybody done anything like this? Is there a better way to get only
&gt; &gt;&gt; the
&gt; &gt;&gt;&gt; project's own classes?
&gt; &gt;&gt;&gt;
&gt; &gt;&gt; Why are you wanting to do this?
&gt; &gt;&gt;
&gt; &gt;&gt; Are the output files in target/classes and target/test-classes not
&gt; &gt;&gt; sufficient?
&gt; &gt;&gt;
&gt;
&gt;
&gt; ---
&gt; L'absence de virus dans ce courrier électronique a été vérifiée par le
&gt; logiciel antivirus Avast.
&gt; https://www.avast.com/antivirus
&gt;
&gt;
&gt; ---------------------------------------------------------------------
&gt; To unsubscribe, e-mail: users-unsubscribe@maven.apache.org
&gt; For additional commands, e-mail: users-help@maven.apache.org
&gt;
&gt;

</pre></td></tr>
   <tr class="mime">
    <td class="left">Mime</td>
    <td class="right">
<ul>
<li>Unnamed multipart/alternative (inline, None, 0 bytes)</li>
<ul>
<li><a rel="nofollow" href="/mod_mbox/maven-users/201609.mbox/raw/%3cCAL5zq9a+vYwdg08ty+CU0Z8ydH2Hf2W5LQyrjJDvL-ckANFZXA@mail.gmail.com%3e/1">Unnamed text/plain</a> (inline, Quoted Printable, 3985 bytes)</li>
</ul>
</ul>
</td>
</tr>
   <tr class="raw">
    <td class="left"></td>
    <td class="right"><a href="/mod_mbox/maven-users/201609.mbox/raw/%3cCAL5zq9a+vYwdg08ty+CU0Z8ydH2Hf2W5LQyrjJDvL-ckANFZXA@mail.gmail.com%3e" rel="nofollow">View raw message</a></td>
   </tr>
   </tbody>
  </table>
 </body>
</html>
