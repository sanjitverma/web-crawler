<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN"
"http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd">

<html xmlns="http://www.w3.org/1999/xhtml">
 <head>
  <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
  <title>Re: Preleminary Maven 3.4.0-SNAPSHOT Testing (Take 3)</title>
  <link rel="stylesheet" type="text/css" href="/archives/style.css" />
 </head>

 <body id="archives">
  <h1>maven-users mailing list archives</h1>

  <h5>
<a href="http://mail-archives.apache.org/mod_mbox/" title="Back to the archives depot">Site index</a> &middot; <a href="/mod_mbox/maven-users" title="Back to the list index">List index</a></h5>  <table class="static" id="msgview">
   <thead>
    <tr>
    <th class="title">Message view</th>
    <th class="nav"><a href="/mod_mbox/maven-users/201608.mbox/%3ca95c7421-569b-b917-3b94-ccbb37c7ae64@schulte.it%3e" title="Previous by date">&laquo;</a> <a href="/mod_mbox/maven-users/201608.mbox/date" title="View messages sorted by date">Date</a> <a href="/mod_mbox/maven-users/201608.mbox/%3cCADN69ymD7sjbL7FhtoMnSu=CXOs9Rc2YgGHF5MOdamTm1y7sOg@mail.gmail.com%3e" title="Next by date">&raquo;</a> &middot; <a href="/mod_mbox/maven-users/201608.mbox/%3ca95c7421-569b-b917-3b94-ccbb37c7ae64@schulte.it%3e" title="Previous by thread">&laquo;</a> <a href="/mod_mbox/maven-users/201608.mbox/thread" title="View messages sorted by thread">Thread</a> <a href="/mod_mbox/maven-users/201608.mbox/%3cCADN69ymD7sjbL7FhtoMnSu=CXOs9Rc2YgGHF5MOdamTm1y7sOg@mail.gmail.com%3e" title="Next by thread">&raquo;</a></th>
   </tr>
   </thead>

   <tfoot>
    <tr>
    <th class="title"><a href="#archives">Top</a></th>
    <th class="nav"><a href="/mod_mbox/maven-users/201608.mbox/%3ca95c7421-569b-b917-3b94-ccbb37c7ae64@schulte.it%3e" title="Previous by date">&laquo;</a> <a href="/mod_mbox/maven-users/201608.mbox/date" title="View messages sorted by date">Date</a> <a href="/mod_mbox/maven-users/201608.mbox/%3cCADN69ymD7sjbL7FhtoMnSu=CXOs9Rc2YgGHF5MOdamTm1y7sOg@mail.gmail.com%3e" title="Next by date">&raquo;</a> &middot; <a href="/mod_mbox/maven-users/201608.mbox/%3ca95c7421-569b-b917-3b94-ccbb37c7ae64@schulte.it%3e" title="Previous by thread">&laquo;</a> <a href="/mod_mbox/maven-users/201608.mbox/thread" title="View messages sorted by thread">Thread</a> <a href="/mod_mbox/maven-users/201608.mbox/%3cCADN69ymD7sjbL7FhtoMnSu=CXOs9Rc2YgGHF5MOdamTm1y7sOg@mail.gmail.com%3e" title="Next by thread">&raquo;</a></th>
   </tr>
   </tfoot>

   <tbody>
   <tr class="from">
    <td class="left">From</td>
    <td class="right">Christian Schulte ...@schulte.it&gt;</td>
   </tr>
   <tr class="subject">
    <td class="left">Subject</td>
    <td class="right">Re: Preleminary Maven 3.4.0-SNAPSHOT Testing (Take 3)</td>
   </tr>
   <tr class="date">
    <td class="left">Date</td>
    <td class="right">Fri, 12 Aug 2016 17:46:40 GMT</td>
   </tr>
   <tr class="contents"><td colspan="2"><pre>
Am 12.08.2016 um 19:16 schrieb Curtis Rueden:
&gt; Hi all,
&gt;
&gt; Concerned by this thread, I did some tests. And I have to say, the new
&gt; Maven 3.4.0 dependency resolution rules seem like a step backwards.
&gt;
&gt; == REAL-WORLD EXAMPLE ==
&gt;
&gt; Consider the following project:
&gt; https://github.com/fiji/fiji/blob/ced9faee1c4fba9997a3d614759fb6e78e359d4f/pom.xml
&gt;
&gt; Amongst many other dependencies, this project has:
&gt;
&gt; &lt;dependency&gt;
&gt; &lt;groupId&gt;ca.mcgill&lt;/groupId&gt;
&gt; &lt;artifactId&gt;Sholl_Analysis&lt;/artifactId&gt;
&gt; &lt;scope&gt;runtime&lt;/scope&gt;
&gt; &lt;/dependency&gt;
&gt;
&gt; This is defined in the parent sc.fiji:pom-fiji:24.1.0 here:
&gt;
&gt; * https://github.com/fiji/pom-fiji/blob/pom-fiji-24.1.0/pom.xml#L830-L835
&gt; * https://github.com/fiji/pom-fiji/blob/pom-fiji-24.1.0/pom.xml#L255-L256
&gt;
&gt; &lt;properties&gt;
&gt; &lt;!-- Sholl Analysis - https://github.com/tferr/ASA --&gt;
&gt; &lt;Sholl_Analysis.version&gt;3.6.2&lt;/Sholl_Analysis.version&gt;
&gt; &lt;/properties&gt; ...
&gt; &lt;dependencyManagement&gt;
&gt; &lt;dependencies&gt;
&gt; &lt;!-- Sholl Analysis - https://github.com/tferr/ASA --&gt;
&gt; &lt;dependency&gt; &lt;groupId&gt;ca.mcgill&lt;/groupId&gt;
&gt; &lt;artifactId&gt;Sholl_Analysis&lt;/artifactId&gt;
&gt; &lt;version&gt;${Sholl_Analysis.version}&lt;/version&gt; &lt;/dependency&gt;
&gt; &lt;/dependencies&gt;
&gt; &lt;/dependencyManagement&gt;
&gt;
&gt; With Maven 3.3.9, we have:
&gt;
&gt;   $ mvn dependency:list|grep Sholl
&gt;   [INFO]    ca.mcgill:Sholl_Analysis:jar:3.6.2:runtime
&gt;
&gt; But with Maven 3.4.0-20160806.181437-172, we get:
&gt;
&gt;   $ mvn dependency:list|grep Sholl
&gt;   [INFO]    ca.mcgill:Sholl_Analysis:jar:3.6.1:runtime
&gt;
&gt; !!!
&gt;
&gt; I believe this surprising behavior is caused by the fact that the toplevel
&gt; fiji POM needs to also include other BOMs via import scope:
&gt;
&gt; *
&gt; https://github.com/fiji/fiji/blob/ced9faee1c4fba9997a3d614759fb6e78e359d4f/pom.xml#L49-L68
&gt;
&gt; &lt;dependencyManagement&gt;
&gt; &lt;dependencies&gt;
&gt; &lt;!-- BigDataViewer BOM --&gt;
&gt; &lt;dependency&gt;
&gt; &lt;groupId&gt;sc.fiji&lt;/groupId&gt;
&gt; &lt;artifactId&gt;pom-bigdataviewer&lt;/artifactId&gt;
&gt; &lt;version&gt;${pom-bigdataviewer.version}&lt;/version&gt;
&gt; &lt;type&gt;pom&lt;/type&gt;
&gt; &lt;scope&gt;import&lt;/scope&gt;
&gt; &lt;/dependency&gt;
&gt; &lt;!-- TrakEM2 BOM --&gt;
&gt; &lt;dependency&gt;
&gt; &lt;groupId&gt;sc.fiji&lt;/groupId&gt;
&gt; &lt;artifactId&gt;pom-trakem2&lt;/artifactId&gt;
&gt; &lt;version&gt;${pom-trakem2.version}&lt;/version&gt;
&gt; &lt;type&gt;pom&lt;/type&gt;
&gt; &lt;scope&gt;import&lt;/scope&gt;
&gt; &lt;/dependency&gt;
&gt; &lt;/dependencies&gt;
&gt; &lt;/dependencyManagement&gt;
&gt;
&gt; The version of pom-bigdataviewer is 3.2.0:
&gt; * https://github.com/fiji/pom-fiji/blob/pom-fiji-24.1.0/pom.xml#L135-L136
&gt;
&gt; Which extends pom-fiji version 22.3.0 instead of 24.1.0:
&gt; *
&gt; https://github.com/bigdataviewer/pom-bigdataviewer/blob/pom-bigdataviewer-3.2.0/pom.xml#L5-L9
&gt;
&gt; And that version of pom-fiji defines Sholl_Analysis at 3.6.1 instead:
&gt; * https://github.com/fiji/pom-fiji/blob/pom-fiji-22.3.0/pom.xml#L261-L262
&gt;
&gt; == GIST OF THE PROBLEM ==
&gt;
&gt; So, with Maven 3.4.0, dependency management brought in from import scope is
&gt; now trumping that brought in from the parent POM itself.

That's exactly the issue we have solved. The dependency management at 
child level did not override the parent but it should as everything else 
does.

&gt; - IMHO, it violates the Principle of Least Astonishment.

No. It's the opposite. You would expect a child dependency management to 
override the parent and not the other way around.

&gt; - It is now more complicated to compose together multiple "subtrees" of
&gt; components into a final application which needs to inherit multiple BOMs
&gt; from these subtrees.

That's become easier now as you can override things at child level you 
could not have overriden before.

&gt; - It is now not possible to override version properties _in the POM itself_
&gt; to trump the dependencyManagement versions.

That's correct. That's why I wanted to not change the import scope and 
introduce a new scope called include.

&gt;
&gt; But strangely, you _can_ still override the version property on the CLI via
&gt; -DSholl_Analysis.version=x.y.z.

Because that CLI property will override it the parent as well.

&gt; I understand and appreciate that I am naive of the deepest nuances of the
&gt; Maven project model and how it gets synthesized. But:
&gt;
&gt; 1) The above behavior will break all of my projects.
&gt; 2) I do not know how to restructure my components for Maven 3.4.0 to avoid
&gt; this problem.

Simply by applying inheritance. This is what MNG-5971 is about. Imported 
dependencies have not been part of inheritance processing prior 3.4 but 
should. Think about the import scope as a way to just include some 
dependencies in the dependency management where it is used.

&gt; My vote would be to revert to the old behavior, which seems better to me.
&gt; However, if this behavior really must be changed, I would suggest pushing
&gt; it till Maven 4, since it will surely break a lot of existing builds.

It will also fix builds. You could just update your poms to make use of 
inheritance. You would just need to declare the dependency in question 
in the dependency management of the inheritance level in question.

Regards,
-- 
Christian


---------------------------------------------------------------------
To unsubscribe, e-mail: users-unsubscribe@maven.apache.org
For additional commands, e-mail: users-help@maven.apache.org


</pre></td></tr>
   <tr class="mime">
    <td class="left">Mime</td>
    <td class="right">
<ul>
<li><a rel="nofollow" href="/mod_mbox/maven-users/201608.mbox/raw/%3c0dc113cb-50c2-b343-0dc3-6bbfe006fa2b@schulte.it%3e/">Unnamed text/plain</a> (inline, 7-Bit, 5094 bytes)</li>
</ul>
</td>
</tr>
   <tr class="raw">
    <td class="left"></td>
    <td class="right"><a href="/mod_mbox/maven-users/201608.mbox/raw/%3c0dc113cb-50c2-b343-0dc3-6bbfe006fa2b@schulte.it%3e" rel="nofollow">View raw message</a></td>
   </tr>
   </tbody>
  </table>
 </body>
</html>
