<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN"
"http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd">

<html xmlns="http://www.w3.org/1999/xhtml">
 <head>
  <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
  <title>Re: Post processing generated sources</title>
  <link rel="stylesheet" type="text/css" href="/archives/style.css" />
 </head>

 <body id="archives">
  <h1>maven-users mailing list archives</h1>

  <h5>
<a href="http://mail-archives.apache.org/mod_mbox/" title="Back to the archives depot">Site index</a> &middot; <a href="/mod_mbox/maven-users" title="Back to the list index">List index</a></h5>  <table class="static" id="msgview">
   <thead>
    <tr>
    <th class="title">Message view</th>
    <th class="nav"><a href="/mod_mbox/maven-users/201603.mbox/%3cCAFmYSVnY8AOLXh=VOtAWzA5SHU0rrvcUtcaD2gPMnsZsYzCP-g@mail.gmail.com%3e" title="Previous by date">&laquo;</a> <a href="/mod_mbox/maven-users/201603.mbox/date" title="View messages sorted by date">Date</a> <a href="/mod_mbox/maven-users/201603.mbox/%3cCAOAAPExdyLF9kg2p7Tx5y20QT9fMJ4QJhV0kFCnWO6Hee5KKSA@mail.gmail.com%3e" title="Next by date">&raquo;</a> &middot; <a href="/mod_mbox/maven-users/201603.mbox/%3cCANyrOm71y3LRH1U+zTfutJY2PMGWKnP+RcE0Jg4Bw=PC+YH5Ug@mail.gmail.com%3e" title="Previous by thread">&laquo;</a> <a href="/mod_mbox/maven-users/201603.mbox/thread" title="View messages sorted by thread">Thread</a> <a href="/mod_mbox/maven-users/201603.mbox/%3cCAFmYSVnY8AOLXh=VOtAWzA5SHU0rrvcUtcaD2gPMnsZsYzCP-g@mail.gmail.com%3e" title="Next by thread">&raquo;</a></th>
   </tr>
   </thead>

   <tfoot>
    <tr>
    <th class="title"><a href="#archives">Top</a></th>
    <th class="nav"><a href="/mod_mbox/maven-users/201603.mbox/%3cCAFmYSVnY8AOLXh=VOtAWzA5SHU0rrvcUtcaD2gPMnsZsYzCP-g@mail.gmail.com%3e" title="Previous by date">&laquo;</a> <a href="/mod_mbox/maven-users/201603.mbox/date" title="View messages sorted by date">Date</a> <a href="/mod_mbox/maven-users/201603.mbox/%3cCAOAAPExdyLF9kg2p7Tx5y20QT9fMJ4QJhV0kFCnWO6Hee5KKSA@mail.gmail.com%3e" title="Next by date">&raquo;</a> &middot; <a href="/mod_mbox/maven-users/201603.mbox/%3cCANyrOm71y3LRH1U+zTfutJY2PMGWKnP+RcE0Jg4Bw=PC+YH5Ug@mail.gmail.com%3e" title="Previous by thread">&laquo;</a> <a href="/mod_mbox/maven-users/201603.mbox/thread" title="View messages sorted by thread">Thread</a> <a href="/mod_mbox/maven-users/201603.mbox/%3cCAFmYSVnY8AOLXh=VOtAWzA5SHU0rrvcUtcaD2gPMnsZsYzCP-g@mail.gmail.com%3e" title="Next by thread">&raquo;</a></th>
   </tr>
   </tfoot>

   <tbody>
   <tr class="from">
    <td class="left">From</td>
    <td class="right">Jens Teglhus Møller &lt;djar...@gmail.com&gt;</td>
   </tr>
   <tr class="subject">
    <td class="left">Subject</td>
    <td class="right">Re: Post processing generated sources</td>
   </tr>
   <tr class="date">
    <td class="left">Date</td>
    <td class="right">Tue, 22 Mar 2016 07:35:33 GMT</td>
   </tr>
   <tr class="contents"><td colspan="2"><pre>
I think most plugins that generate source code add the target folders as
source folders themselves.

My current problem is to compile and run the rewrite code as part of the
generate-sources phase. What I have right now is the following antrun
invocation:

&lt;plugin&gt;
&lt;groupId&gt;org.apache.maven.plugins&lt;/groupId&gt;
&lt;artifactId&gt;maven-antrun-plugin&lt;/artifactId&gt;
&lt;version&gt;1.8&lt;/version&gt;
&lt;dependencies&gt;
&lt;dependency&gt;&lt;!-- compilation through ant failed, google revealed this
solution --&gt;
&lt;groupId&gt;com.sun&lt;/groupId&gt;
&lt;artifactId&gt;tools&lt;/artifactId&gt;
&lt;version&gt;1.5.0&lt;/version&gt;
&lt;scope&gt;system&lt;/scope&gt;
&lt;systemPath&gt;${env.JAVA_HOME}/lib/tools.jar&lt;/systemPath&gt;
&lt;/dependency&gt;
&lt;/dependencies&gt;
&lt;executions&gt;
&lt;execution&gt;
&lt;id&gt;pre-process-generated-classes&lt;/id&gt;
&lt;phase&gt;generate-sources&lt;/phase&gt;
&lt;goals&gt;
&lt;goal&gt;run&lt;/goal&gt;
&lt;/goals&gt;
&lt;configuration&gt;
&lt;failOnError&gt;true&lt;/failOnError&gt;
&lt;target&gt;
&lt;mkdir dir="target/rewrite-generated-code-classes" /&gt;
&lt;javac destdir="target/rewrite-generated-code-classes"
classpathref="maven.test.classpath"&gt;
&lt;src path="src/rewrite-generated-code/java/" /&gt;&lt;!-- here is the source we
are actually compiling --&gt;
&lt;src path="src/main/java/" /&gt;&lt;!-- RewriteGeneratedClasses references
classes in here --&gt;
&lt;src path="target/generated-sources/jsonschema2pojo"/&gt;&lt;!--
RewriteGeneratedClasses references classes in here --&gt;
&lt;include name="RewriteGeneratedClasses.java"/&gt;&lt;!-- make sure we only
compile the rewrite classed --&gt;
&lt;/javac&gt;
&lt;java failonerror="true" classname="RewriteGeneratedClasses"
classpath="target/rewrite-generated-code-classes"
classpathref="maven.test.classpath"/&gt;
&lt;/target&gt;
&lt;/configuration&gt;
&lt;/execution&gt;
&lt;/executions&gt;
&lt;/plugin&gt;

So I gave src/rewrite-generated-code/java/RewriteGeneratedClasses.java
which I compile and execute through antrun. It reads the generated code
in target/generated-sources/jsonschema2pojo massages it a big and writes it
back to the same file.

It actually works fine, but I'm a bit unsure if it is just too complex, I
will probably not understand it myself in a week and the rest of the
dev-team will hunt me down with pitchforks if they have to maintain it one
day.

Best regards Jens


On Mon, Mar 21, 2016 at 12:50 PM, Jeff MAURY &lt;jeffmaury@gmail.com&gt; wrote:

&gt; You can generate in any folder (under target) but you must add this folder
&gt; to the list of source directories so that the maven compiler will process
&gt; them
&gt; This can be done with the maven API if you have your own Maven plugin or
&gt; with the build-helper-plugin
&gt;
&gt; Jeff
&gt; Le 21 mars 2016 12:45, "Jens Teglhus Møller" &lt;djarnis@gmail.com&gt; a écrit :
&gt;
&gt; &gt; Thanks for the short and precise answer.
&gt; &gt;
&gt; &gt; Any guidelines as how to organize the code that performs the processing.
&gt; &gt; Should I create a new directory in src separate from main and test i.e.
&gt; &gt; preprocess and compile it to target/preprocess-classes?
&gt; &gt;
&gt; &gt; Best regards Jens
&gt; &gt;
&gt; &gt; And where should i put my source that does the post processing should i
&gt; &gt; create my own
&gt; &gt;
&gt; &gt; On Mon, Mar 21, 2016 at 12:29 PM, Jeff MAURY &lt;jeffmaury@gmail.com&gt;
&gt; wrote:
&gt; &gt;
&gt; &gt; &gt; Generate-sources
&gt; &gt; &gt;
&gt; &gt; &gt; Jeff
&gt; &gt; &gt; Le 21 mars 2016 12:25, "Jens Teglhus Møller" &lt;djarnis@gmail.com&gt; a
&gt; &gt; écrit :
&gt; &gt; &gt;
&gt; &gt; &gt; &gt; Hi
&gt; &gt; &gt; &gt;
&gt; &gt; &gt; &gt; I'm generating java sources (using jsonschema2pojo and
&gt; &gt; jaxb2-maven-plugin
&gt; &gt; &gt; &gt; plugin) and I would like to do some post processing on the generated
&gt; &gt; &gt; source
&gt; &gt; &gt; &gt; files before compiling them (like have some of the generated files
&gt; &gt; &gt; &gt; implement certain interfaces, perhaps using roaster).
&gt; &gt; &gt; &gt;
&gt; &gt; &gt; &gt; I'm a bit unsure which phase I should do that in and if I do it with
&gt; &gt; &gt; &gt; roaster I will have probably have a few java files that I would need
&gt; to
&gt; &gt; &gt; &gt; compile and run on the source files (I would prefer not to på that
&gt; in a
&gt; &gt; &gt; &gt; separate project). It could probably be done quite easily with
&gt; &gt; &gt; &gt; maven-antrun-plugin but I'm but I'm interested to know if there is a
&gt; &gt; &gt; smart
&gt; &gt; &gt; &gt; way to do it.
&gt; &gt; &gt; &gt;
&gt; &gt; &gt; &gt; Best regards Jens
&gt; &gt; &gt; &gt;
&gt; &gt; &gt;
&gt; &gt;
&gt;

</pre></td></tr>
   <tr class="mime">
    <td class="left">Mime</td>
    <td class="right">
<ul>
<li>Unnamed multipart/alternative (inline, None, 0 bytes)</li>
<ul>
<li><a rel="nofollow" href="/mod_mbox/maven-users/201603.mbox/raw/%3cCAOAAPEwKRD8VFZeevjO1DDnrZHp8UmmHU_Y+dn+Ys9dFJ6nTAA@mail.gmail.com%3e/1">Unnamed text/plain</a> (inline, Quoted Printable, 4032 bytes)</li>
</ul>
</ul>
</td>
</tr>
   <tr class="raw">
    <td class="left"></td>
    <td class="right"><a href="/mod_mbox/maven-users/201603.mbox/raw/%3cCAOAAPEwKRD8VFZeevjO1DDnrZHp8UmmHU_Y+dn+Ys9dFJ6nTAA@mail.gmail.com%3e" rel="nofollow">View raw message</a></td>
   </tr>
   </tbody>
  </table>
 </body>
</html>
