<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN"
"http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd">

<html xmlns="http://www.w3.org/1999/xhtml">
 <head>
  <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
  <title>Re: Layered BOMs and overriding dependency management</title>
  <link rel="stylesheet" type="text/css" href="/archives/style.css" />
 </head>

 <body id="archives">
  <h1>maven-users mailing list archives</h1>

  <h5>
<a href="http://mail-archives.apache.org/mod_mbox/" title="Back to the archives depot">Site index</a> &middot; <a href="/mod_mbox/maven-users" title="Back to the list index">List index</a></h5>  <table class="static" id="msgview">
   <thead>
    <tr>
    <th class="title">Message view</th>
    <th class="nav"><a href="/mod_mbox/maven-users/201611.mbox/%3c1478185050061-5884866.post@n5.nabble.com%3e" title="Previous by date">&laquo;</a> <a href="/mod_mbox/maven-users/201611.mbox/date" title="View messages sorted by date">Date</a> <a href="/mod_mbox/maven-users/201611.mbox/%3c1478189659892-5884868.post@n5.nabble.com%3e" title="Next by date">&raquo;</a> &middot; <a href="/mod_mbox/maven-users/201611.mbox/%3c1478185050061-5884866.post@n5.nabble.com%3e" title="Previous by thread">&laquo;</a> <a href="/mod_mbox/maven-users/201611.mbox/thread" title="View messages sorted by thread">Thread</a> <a href="/mod_mbox/maven-users/201611.mbox/%3c1478189659892-5884868.post@n5.nabble.com%3e" title="Next by thread">&raquo;</a></th>
   </tr>
   </thead>

   <tfoot>
    <tr>
    <th class="title"><a href="#archives">Top</a></th>
    <th class="nav"><a href="/mod_mbox/maven-users/201611.mbox/%3c1478185050061-5884866.post@n5.nabble.com%3e" title="Previous by date">&laquo;</a> <a href="/mod_mbox/maven-users/201611.mbox/date" title="View messages sorted by date">Date</a> <a href="/mod_mbox/maven-users/201611.mbox/%3c1478189659892-5884868.post@n5.nabble.com%3e" title="Next by date">&raquo;</a> &middot; <a href="/mod_mbox/maven-users/201611.mbox/%3c1478185050061-5884866.post@n5.nabble.com%3e" title="Previous by thread">&laquo;</a> <a href="/mod_mbox/maven-users/201611.mbox/thread" title="View messages sorted by thread">Thread</a> <a href="/mod_mbox/maven-users/201611.mbox/%3c1478189659892-5884868.post@n5.nabble.com%3e" title="Next by thread">&raquo;</a></th>
   </tr>
   </tfoot>

   <tbody>
   <tr class="from">
    <td class="left">From</td>
    <td class="right">Christian Schulte ...@schulte.it&gt;</td>
   </tr>
   <tr class="subject">
    <td class="left">Subject</td>
    <td class="right">Re: Layered BOMs and overriding dependency management</td>
   </tr>
   <tr class="date">
    <td class="left">Date</td>
    <td class="right">Thu, 03 Nov 2016 15:45:13 GMT</td>
   </tr>
   <tr class="contents"><td colspan="2"><pre>
Am 11/03/16 um 15:57 schrieb Dave Syer:
&gt; I would like to be able to write a BOM and tell Maven that for some
&gt; dependencies, I am aware of a conflict in the dependency management, but the
&gt; conflict arises in a library I don't control, and I know with high
&gt; confidence that my users either a) don't care, or b) would be happy with my
&gt; recommendation. Unfortunately I don't think there is a sensible way to make
&gt; that recommendation.
&gt; 
&gt; Here's the concrete actual problem. Spring Cloud has a "release train" which
&gt; consists of a "BOM of BOMs"[1], aggregating a bunch of related projects
&gt; together by importing their BOMs and providing users with a useful single
&gt; point of contact for all the dependencies. It has provide to be a very
&gt; popular and successful feature (same with Spring Boot[2]). The problem is
&gt; that one of the imported BOMs (Spring Cloud AWS[3]) itself imports a third
&gt; party BOM from AWS[4], which itself manages the version of Wiremock[5] (via
&gt; its parent[6]). Wiremock is not even used in Spring Cloud AWS, but it
&gt; spreads the dependency management to all downstream projects that use its
&gt; BOM. Now Wiremock is actually something we care about elsewhere in Spring
&gt; Cloud: it is a compile time dependency of Spring Cloud Contract[7] and
&gt; naturally we need a different version there.
&gt; 
&gt; The visible symptom of this problem is that for any user project that uses
&gt; the Spring Cloud BOM, they see a warning in the build logs about a version
&gt; conflict for Wiremock. With Maven 3.4 it looks like this currently:
&gt; 
&gt; [WARNING] Dependency 'com.github.tomakehurst:wiremock:jar' has conflicting
&gt; dependency management in model
&gt; 'org.springframework.cloud:spring-cloud-dependencies:pom:Camden.SR1'
&gt; ('org.springframework.cloud:spring-cloud-contract-dependencies:1.0.1.RELEASE',
&gt; 'com.amazonaws:aws-java-sdk-pom:1.11.18'). To resolve the conflicts, either
&gt; declare the dependency management for dependency
&gt; 'com.github.tomakehurst:wiremock:jar' directly in the dependency management
&gt; of model
&gt; 'org.springframework.cloud:spring-cloud-dependencies:pom:Camden.SR1' to
&gt; override what gets imported or - as of model version 4.1.0 - rearrange the
&gt; causing imports in the inheritance hierarchy to apply standard override
&gt; logic based on artifact coordinates. Without resolving the conflicts, your
&gt; build relies on indeterministic behaviour. @
&gt; org.springframework.cloud:spring-cloud-dependencies:Camden.SR1
&gt; 
&gt; This is independent of whether they intend to use AWS, Contract or Wiremock.
&gt; Of course it is true that there is a conflict, but I happen to know that if
&gt; they are using any Wiremock features that I provided they will get the
&gt; correct version. I doubt very much if the AWS SDK team care a fig. One way I
&gt; know to "fix" this warning is to explicitly add dependency management to the
&gt; user project for Wiremock, even though the user has no intention of using
&gt; it. The same would apply for virtually any unused, but managed dependency.
&gt; The suggestion in the log there is to manage it explicitly in
&gt; spring-cloud-dependencies, but then I have to synchronize the version
&gt; between there are Spring Cloud Contract, which is ugly. I could do that, but
&gt; then logically I'd have to do it for all the unused dependencies, which in
&gt; principle I have no control over and possibly also no opinion about. Also
&gt; I'd have to co-ordinate the version for those dependencies between two
&gt; projects that don't depend on each other and one of which doesn't even care
&gt; about the dependency or its version. This would be tiresome.
&gt; 
&gt; You can see an attempt to exclude Wiremock from the Spring Cloud AWS BOM[8].
&gt; But this doesn't do anything. As far as I know &lt;exclusions/&gt; in a BOM import
&gt; have no effect, so the semantics are undefined.

Using current 3.4.0-SNAPSHOT master you can set the model version to
4.1.0 and then you can use excludes in the dependency management import.
Would that solve the issue for you? Could you give that a quick test? I
know we are not going to release model version 4.1.0. It'd like to know
if support for the exclusions element in dependency management imports
need to be provided together with the changes to the import scope.

Regards,
-- 
Christian


---------------------------------------------------------------------
To unsubscribe, e-mail: users-unsubscribe@maven.apache.org
For additional commands, e-mail: users-help@maven.apache.org


</pre></td></tr>
   <tr class="mime">
    <td class="left">Mime</td>
    <td class="right">
<ul>
<li><a rel="nofollow" href="/mod_mbox/maven-users/201611.mbox/raw/%3c5a462ba1-b38c-e901-0c15-19b484a0d097@schulte.it%3e/">Unnamed text/plain</a> (inline, 7-Bit, 4421 bytes)</li>
</ul>
</td>
</tr>
   <tr class="raw">
    <td class="left"></td>
    <td class="right"><a href="/mod_mbox/maven-users/201611.mbox/raw/%3c5a462ba1-b38c-e901-0c15-19b484a0d097@schulte.it%3e" rel="nofollow">View raw message</a></td>
   </tr>
   </tbody>
  </table>
 </body>
</html>
