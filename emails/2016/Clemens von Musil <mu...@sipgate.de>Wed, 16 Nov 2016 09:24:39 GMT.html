<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN"
"http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd">

<html xmlns="http://www.w3.org/1999/xhtml">
 <head>
  <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
  <title>Re: Building WAR files with/without EAR context</title>
  <link rel="stylesheet" type="text/css" href="/archives/style.css" />
 </head>

 <body id="archives">
  <h1>maven-users mailing list archives</h1>

  <h5>
<a href="http://mail-archives.apache.org/mod_mbox/" title="Back to the archives depot">Site index</a> &middot; <a href="/mod_mbox/maven-users" title="Back to the list index">List index</a></h5>  <table class="static" id="msgview">
   <thead>
    <tr>
    <th class="title">Message view</th>
    <th class="nav"><a href="/mod_mbox/maven-users/201611.mbox/%3c20161116092409.1ea10c7b@xss.co.at%3e" title="Previous by date">&laquo;</a> <a href="/mod_mbox/maven-users/201611.mbox/date" title="View messages sorted by date">Date</a> <a href="/mod_mbox/maven-users/201611.mbox/%3c20161116103909.1f54d39c@xss.co.at%3e" title="Next by date">&raquo;</a> &middot; <a href="/mod_mbox/maven-users/201611.mbox/%3c20161116092409.1ea10c7b@xss.co.at%3e" title="Previous by thread">&laquo;</a> <a href="/mod_mbox/maven-users/201611.mbox/thread" title="View messages sorted by thread">Thread</a> <a href="/mod_mbox/maven-users/201611.mbox/%3c20161116103909.1f54d39c@xss.co.at%3e" title="Next by thread">&raquo;</a></th>
   </tr>
   </thead>

   <tfoot>
    <tr>
    <th class="title"><a href="#archives">Top</a></th>
    <th class="nav"><a href="/mod_mbox/maven-users/201611.mbox/%3c20161116092409.1ea10c7b@xss.co.at%3e" title="Previous by date">&laquo;</a> <a href="/mod_mbox/maven-users/201611.mbox/date" title="View messages sorted by date">Date</a> <a href="/mod_mbox/maven-users/201611.mbox/%3c20161116103909.1f54d39c@xss.co.at%3e" title="Next by date">&raquo;</a> &middot; <a href="/mod_mbox/maven-users/201611.mbox/%3c20161116092409.1ea10c7b@xss.co.at%3e" title="Previous by thread">&laquo;</a> <a href="/mod_mbox/maven-users/201611.mbox/thread" title="View messages sorted by thread">Thread</a> <a href="/mod_mbox/maven-users/201611.mbox/%3c20161116103909.1f54d39c@xss.co.at%3e" title="Next by thread">&raquo;</a></th>
   </tr>
   </tfoot>

   <tbody>
   <tr class="from">
    <td class="left">From</td>
    <td class="right">Clemens von Musil &lt;mu...@sipgate.de&gt;</td>
   </tr>
   <tr class="subject">
    <td class="left">Subject</td>
    <td class="right">Re: Building WAR files with/without EAR context</td>
   </tr>
   <tr class="date">
    <td class="left">Date</td>
    <td class="right">Wed, 16 Nov 2016 09:24:39 GMT</td>
   </tr>
   <tr class="contents"><td colspan="2"><pre>
This is true for jar dependencies.

But if the war file depends on an artifact with type ejb
(&lt;type&gt;ejb&lt;/type&gt;), the skinnywar-option ignores this dependency and let it
remain in war/lib.

And if there are two war files WAR1 and WAR2 depending on the same artifact
with type ejb, the ear isn't deployable as the beans within the
ejb-artifact resist in WAR1/lib _and_ WAR2/lib. The container tries to
deploy beans from both loations and struggles as it cannot deploy the same
bean twice.

We found a workaound. We define all dependencies without the type-tag to
keep the skinnywar-option working. To avoid malicious packaging inside the
EAR, we define all these dependencies as jarmodules with explicit deploy
path and entry in the application.xml. Such a definition looks like

&lt;jarModule&gt;
    &lt;groupId&gt;groupid&lt;/groupId&gt;
    &lt;artifactId&gt;artifactid&lt;/artifactId&gt;
    &lt;includeInApplicationXml&gt;true&lt;/includeInApplicationXml&gt;
    &lt;bundleDir&gt;/&lt;/bundleDir&gt;
&lt;/jarModule&gt;

Ugly but working.


2016-11-16 9:24 GMT+01:00 Martin Hoeller &lt;martin@xss.co.at&gt;:

&gt; On 14 Nov 2016, Clemens von Musil wrote:
&gt;
&gt; &gt; Hi again,
&gt; &gt;
&gt; &gt; thanks a lot for your advice, Martin.
&gt; &gt;
&gt; &gt; We spent a lot of time into skinny wars but stuck with ejb dependencies.
&gt; &gt;
&gt; &gt; The EAR contains several WAR modules and these WAR modules share several
&gt; &gt; EJB modules.
&gt; &gt; Unfortunately, the skinny war option seems to ignore transitive EJB
&gt; &gt; dependencies so that we get errors with duplicate beans on startup.
&gt;
&gt; The skinnyWar-option should just remove JARs from the WAR that are also
&gt; defined in the POM of the EAR module. Nothing special about transitive
&gt; dependencies here I' guess.
&gt;
&gt; Try this again:
&gt; https://maven.apache.org/plugins/maven-ear-plugin/
&gt; examples/skinny-wars.html
&gt;
&gt; If you list a dependency in the EAR, it should then be removed from the
&gt; WAR that is bundled with the EAR (this not the WAR installed in your
&gt; local repo!).
&gt;
&gt; If this is not the case, there is either a bug, or you are doing
&gt; something wrong. But you would need to provide more details: POMs of the
&gt; WAR and the EAR and a listing of the relevant EAR and WAR contents.
&gt;
&gt; hth,
&gt; - martin
&gt;



-- 

Clemens von Musil - musil@sipgate.de
Telefon: +49 (0)211-63 55 56-85
Telefax: +49 (0)211-63 55 55-22

sipgate GmbH - Gladbacher Str. 74 - 40219 D체sseldorf
HRB D체sseldorf 39841 - Gesch채ftsf체hrer: Thilo Salmon, Tim Mois
Steuernummer: 106/5724/7147, Umsatzsteuer-ID: DE219349391

www.sipgate.de - www.sipgate.at - www.sipgate.co.uk

</pre></td></tr>
   <tr class="mime">
    <td class="left">Mime</td>
    <td class="right">
<ul>
<li>Unnamed multipart/alternative (inline, None, 0 bytes)</li>
<ul>
<li><a rel="nofollow" href="/mod_mbox/maven-users/201611.mbox/raw/%3cCAJ4M5n4gEUNHodW6Aq1dFwnE-MPqmxN3jgTEDi7S1A1EYJ+7Fw@mail.gmail.com%3e/1">Unnamed text/plain</a> (inline, Quoted Printable, 2519 bytes)</li>
</ul>
</ul>
</td>
</tr>
   <tr class="raw">
    <td class="left"></td>
    <td class="right"><a href="/mod_mbox/maven-users/201611.mbox/raw/%3cCAJ4M5n4gEUNHodW6Aq1dFwnE-MPqmxN3jgTEDi7S1A1EYJ+7Fw@mail.gmail.com%3e" rel="nofollow">View raw message</a></td>
   </tr>
   </tbody>
  </table>
 </body>
</html>
